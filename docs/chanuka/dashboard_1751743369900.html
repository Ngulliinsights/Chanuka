<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Chanuka - Dashboard for tracking Kenyan legislation">
  <title>Chanuka – Dashboard</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <style>
    /* Reset & Base */
    :root {
      --color-primary: #0d3b66;
      --color-accent: #f38a1f;
      --color-accent-hover: #d47716;
      --color-text: #333;
      --color-text-light: #555;
      --color-background: #f5f7fa;
      --color-white: #fff;
      --color-border: #ccc;
      --color-tab-inactive: #e5e7eb;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 1px 4px rgba(0,0,0,0.1);
      --radius-sm: 0.3rem;
      --radius-md: 0.5rem;
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 0.75rem;
      --spacing-lg: 1rem;
      --spacing-xl: 1.5rem;
      --spacing-2xl: 2rem;
      --font-sm: 0.9rem;
      --font-md: 1rem;
      --font-lg: 1.5rem;
      --font-xl: 2rem;
      --transition-hover: 0.2s ease;
    }

    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--color-background);
      color: var(--color-text);
      line-height: 1.5;
    }
    
    a { 
      text-decoration: none; 
      color: inherit; 
    }
    
    .btn { 
      background: var(--color-accent); 
      color: var(--color-white); 
      border: none; 
      padding: 0.6rem var(--spacing-lg); 
      border-radius: var(--radius-sm); 
      cursor: pointer; 
      transition: background var(--transition-hover);
      font-weight: 500;
    }
    
    .btn:hover { 
      background: var(--color-accent-hover); 
    }
    
    .btn:focus {
      outline: 2px solid var(--color-accent);
      outline-offset: 2px;
    }

    /* Layout Components */
    header { 
      background: var(--color-primary); 
      color: var(--color-white); 
      padding: var(--spacing-lg) var(--spacing-2xl); 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      box-shadow: var(--shadow-md);
    }
    
    header h1 { 
      font-size: var(--font-lg);
      font-weight: 600;
    }

    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: var(--spacing-lg);
    }

    /* Greeting Section */
    .greeting { 
      margin-bottom: var(--spacing-2xl); 
      display: flex; 
      flex-wrap: wrap; 
      justify-content: space-between; 
      align-items: center; 
      gap: var(--spacing-lg); 
    }
    
    .greeting h2 { 
      font-size: var(--font-xl);
      color: var(--color-primary);
    }
    
    .greeting p { 
      color: var(--color-text-light);
      margin-top: var(--spacing-xs);
    }

    /* Search & Filters */
    .search-bar { 
      display: flex; 
      flex-wrap: wrap; 
      gap: var(--spacing-sm); 
      margin-bottom: var(--spacing-2xl); 
    }
    
    .search-bar input { 
      flex: 1; 
      padding: 0.6rem var(--spacing-lg) 0.6rem 2.5rem; 
      border-radius: var(--radius-sm); 
      border: 1px solid var(--color-border); 
      background: var(--color-white) url('data:image/svg+xml,%3Csvg width="16" height="16" fill="none" stroke="%23999" stroke-width="2" xmlns="http://www.w3.org/2000/svg"%3E%3Ccircle cx="7" cy="7" r="5"/%3E%3Cpath d="M11 11l4 4"/%3E%3C/svg%3E') no-repeat 10px center; 
      background-size: 16px;
      min-width: 200px;
    }
    
    .search-bar input:focus {
      outline: 2px solid var(--color-primary);
      outline-offset: 0;
      border-color: var(--color-primary);
    }
    
    .search-bar select { 
      padding: 0.6rem var(--spacing-lg); 
      border-radius: var(--radius-sm); 
      border: 1px solid var(--color-border);
      background-color: var(--color-white);
      cursor: pointer;
    }
    
    .search-bar select:focus {
      outline: 2px solid var(--color-primary);
      outline-offset: 0;
      border-color: var(--color-primary);
    }

    /* Main Layout */
    .grid { 
      display: grid; 
      grid-template-columns: 2fr 1fr; 
      gap: var(--spacing-xl); 
    }
    
    @media (max-width: 800px) { 
      .grid { 
        grid-template-columns: 1fr; 
      }
      
      .search-bar {
        flex-direction: column;
      }
      
      .greeting {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    /* Tabs Component */
    .tabs { 
      background: var(--color-white); 
      border-radius: var(--radius-md); 
      box-shadow: var(--shadow-md);
      overflow: hidden;
    }
    
    .tab-list { 
      display: flex;
      border-bottom: 1px solid var(--color-border);
    }
    
    .tab-list button { 
      flex: 1; 
      padding: var(--spacing-md) var(--spacing-lg); 
      border: none; 
      background: var(--color-tab-inactive); 
      cursor: pointer;
      font-weight: 500;
      transition: background var(--transition-hover), color var(--transition-hover);
    }
    
    .tab-list button:hover:not(.active) {
      background: #d8dbe2;
    }
    
    .tab-list button.active { 
      background: var(--color-accent); 
      color: var(--color-white);
    }
    
    .tab-list button:focus {
      outline: 2px solid var(--color-primary);
      outline-offset: -2px;
      z-index: 1;
      position: relative;
    }
    
    .tab-content { 
      padding: var(--spacing-lg);
    }
    
    .bill-item { 
      background: var(--color-white); 
      padding: var(--spacing-lg); 
      margin-bottom: var(--spacing-md); 
      border-radius: var(--radius-sm); 
      box-shadow: var(--shadow-sm);
      border-left: 3px solid var(--color-accent);
      transition: transform var(--transition-hover), box-shadow var(--transition-hover);
    }
    
    .bill-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }
    
    .bill-item h3 { 
      margin-bottom: var(--spacing-xs);
      color: var(--color-primary);
    }
    
    .bill-item p { 
      color: var(--color-text-light); 
      font-size: var(--font-sm);
    }
    
    .bill-actions {
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-sm);
    }
    
    .bill-actions button {
      background: transparent;
      border: 1px solid var(--color-border);
      padding: 0.3rem var(--spacing-sm);
      border-radius: var(--radius-sm);
      font-size: var(--font-sm);
      cursor: pointer;
      transition: background var(--transition-hover);
    }
    
    .bill-actions button:hover {
      background: #f0f0f0;
    }

    /* Sidebar Cards */
    .card { 
      background: var(--color-white); 
      border-radius: var(--radius-md); 
      box-shadow: var(--shadow-md); 
      padding: var(--spacing-lg); 
      margin-bottom: var(--spacing-xl);
    }
    
    .card h3 { 
      margin-bottom: var(--spacing-md);
      color: var(--color-primary);
      font-size: var(--font-md);
      border-bottom: 1px solid #eee;
      padding-bottom: var(--spacing-xs);
    }
    
    .card ul { 
      list-style: none; 
      padding-left: 0; 
    }
    
    .card li { 
      margin-bottom: var(--spacing-sm); 
      color: var(--color-text-light); 
      font-size: var(--font-sm);
      display: flex;
      align-items: center;
    }
    
    .card li::before {
      content: "•";
      color: var(--color-accent);
      font-weight: bold;
      margin-right: var(--spacing-sm);
    }

    /* Tags */
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: var(--spacing-sm);
    }
    
    .tag {
      display: inline-block;
      background: var(--color-background);
      color: var(--color-primary);
      padding: 0.25rem 0.75rem;
      font-size: var(--font-sm);
      font-weight: 500;
      border-radius: 1rem;
      border: 1px solid var(--color-border);
    }
    
    .deadline {
      display: flex;
      align-items: center;
      font-size: var(--font-sm);
      color: var(--color-text-light);
      margin-bottom: var(--spacing-sm);
    }
    
    .deadline-soon {
      color: #dc3545;
      font-weight: 500;
    }
    
    .participants {
      font-size: var(--font-sm);
      color: var(--color-text-light);
      margin-bottom: var(--spacing-sm);
    }

    /* Loading state */
    .loading {
      text-align: center;
      padding: var(--spacing-2xl);
      color: var(--color-text-light);
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--color-accent);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto var(--spacing-lg);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Helper classes */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>
</head>
<body>

  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="visually-hidden">Skip to content</a>

  <!-- Header -->
  <header>
    <div class="header-content">
      <h1><img src="images/Chanuka_logo.svg" alt="Chanuka" class="logo-img">Chanuka Dashboard</h1>
      <nav class="header-nav">
        <button class="btn" id="profileBtn" aria-label="My Profile">My Profile</button>
      </nav>
    </div>
  </header>

  <main class="container" id="main-content">

    <!-- Greeting -->
    <section class="greeting" aria-labelledby="greeting-heading">
      <div>
        <h2 id="greeting-heading">Welcome, Citizen</h2>
        <p>Track legislation, analyze bills, and engage with Kenyan governance</p>
      </div>
      <button class="btn" id="onboardingBtn">Complete Your Profile</button>
    </section>

    <!-- Search & Filters -->
    <section aria-label="Search and filter bills">      <div class="search-bar">
        <label for="searchInput" class="visually-hidden">Search bills</label>
        <input id="searchInput" placeholder="Search bills, topics, or stakeholders…" aria-label="Search bills, topics, or stakeholders">
        
        <label for="countySelect" class="visually-hidden">Filter by county</label>
        <select id="countySelect" aria-label="Filter by county">
          <option value="">All Counties</option>
          <option>Nairobi</option>
          <option>Mombasa</option>
          <option>Kisumu</option>
          <option>Nakuru</option>
          <option>Kiambu</option>
          <option>Machakos</option>
        </select>

        <label for="categorySelect" class="visually-hidden">Filter by category</label>
        <select id="categorySelect" aria-label="Filter by category">
          <option value="">All Categories</option>
          <option>Finance</option>
          <option>Health</option>
          <option>Education</option>
          <option>Infrastructure</option>
          <option>Agriculture</option>
          <option>Environment</option>
        </select>
        
        <label for="filterSelect" class="visually-hidden">Filter bills</label>
        <select id="filterSelect" aria-label="Filter bills by status">
          <option value="active">Active Bills</option>
          <option value="upcoming">Upcoming Bills</option>
          <option value="passed">Passed Bills</option>
          <option value="closing">Closing Soon</option>
        </select>
      </div>
    </section>

    <!-- Main Grid -->
    <div class="grid">
      <!-- Main Tabs -->
      <section aria-labelledby="bills-heading">
        <h2 id="bills-heading" class="visually-hidden">Bills</h2>
        <div class="tabs">          <div class="tab-list" role="tablist">
            <button id="tab-button-all" data-tab="all" class="active" role="tab" aria-selected="true" aria-controls="tab-all">All Bills</button>
            <button id="tab-button-tracked" data-tab="tracked" role="tab" aria-selected="false" aria-controls="tab-tracked">Tracked</button>
            <button id="tab-button-recommended" data-tab="recommended" role="tab" aria-selected="false" aria-controls="tab-recommended">Recommended</button>
            <button id="tab-button-consultations" data-tab="consultations" role="tab" aria-selected="false" aria-controls="tab-consultations">Consultations</button>
          </div>
          <div id="tab-all" class="tab-content" role="tabpanel" aria-labelledby="tab-button-all">
            <!-- Bill List will be injected here -->
            <div class="loading">
              <div class="loading-spinner"></div>
              <p>Loading bills...</p>
            </div>
          </div>
          <div id="tab-tracked" class="tab-content" style="display:none;" role="tabpanel" aria-labelledby="tab-button-tracked">
            <!-- Tracked bills will be injected here -->
          </div>
          <div id="tab-recommended" class="tab-content" style="display:none;" role="tabpanel" aria-labelledby="tab-button-recommended">
            <!-- Recommended bills will be injected here -->
          </div>
          <div id="tab-consultations" class="tab-content" style="display:none;" role="tabpanel" aria-labelledby="tab-button-consultations">
            <!-- Consultations will be injected here -->
          </div>
        </div>
      </section>

      <!-- Sidebar -->
      <aside aria-label="Dashboard widgets">
        <div class="card">
          <h3>Action Items</h3>
          <ul>
            <li>Review Finance Bill 2024</li>
            <li>Comment on Health Bill</li>
            <li>Upvote Transportation Bill</li>
          </ul>
        </div>
        <div class="card">
          <h3>Tracked Topics</h3>
          <ul>
            <li>Devolution Funding</li>
            <li>Tax Reform</li>
            <li>Healthcare Access</li>
          </ul>
        </div>
        <div class="card">
          <h3>Activity Summary</h3>
          <ul>
            <li>5 Comments Posted</li>
            <li>3 Bills Tracked</li>
            <li>2 Endorsements</li>
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // Enhanced Kenyan Bills Civic Engagement Platform Script
(function() {
  'use strict';

  // Enhanced mock bill data with current and strategic/controversial Kenyan bills
  const mockBills = [
    // NATIONAL LEVEL - Highly Controversial Bills
    { 
      id: 'bill-1',
      title: 'Social Health Insurance Fund (SHIF) Implementation Bill', 
      desc: 'Replace NHIF with new universal health coverage system requiring 2.75% salary deduction',
      status: 'active',
      county: 'National',
      category: 'Health',
      deadline: '2025-07-15',
      participants: 2847,
      isTracked: true,
      controversy: 'high',
      impact: 'All Kenyans will be affected by mandatory health insurance deductions',
      tags: ['universal-healthcare', 'mandatory-deduction', 'health-reform']
    },
    { 
      id: 'bill-2',
      title: 'Finance Bill 2025', 
      desc: 'Proposed tax increases on digital services, luxury goods, and carbon tax introduction',
      status: 'upcoming',
      county: 'National',
      category: 'Finance',
      deadline: '2025-06-30',
      participants: 4521,
      isTracked: false,
      controversy: 'high',
      impact: 'Economic implications for businesses and consumers nationwide',
      tags: ['taxation', 'digital-tax', 'carbon-tax', 'economic-policy']
    },
    { 
      id: 'bill-3',
      title: 'Housing Development Levy Bill', 
      desc: '1.5% salary deduction for affordable housing fund - implementation guidelines',
      status: 'active',
      county: 'National',
      category: 'Housing',
      deadline: '2025-08-10',
      participants: 3124,
      isTracked: false,
      controversy: 'high',
      impact: 'Mandatory deduction from all formal employment salaries',
      tags: ['housing-levy', 'affordable-housing', 'mandatory-deduction']
    },
    { 
      id: 'bill-4',
      title: 'Public Order Amendment Bill', 
      desc: 'Enhanced powers for police during public demonstrations and assemblies',
      status: 'active',
      county: 'National',
      category: 'Security',
      deadline: '2025-09-05',
      participants: 1876,
      isTracked: true,
      controversy: 'high',
      impact: 'Affects constitutional rights to assembly and demonstration',
      tags: ['civil-rights', 'police-powers', 'public-assembly']
    },
    { 
      id: 'bill-5',
      title: 'Digital Assets and Virtual Currencies Regulation Bill', 
      desc: 'Framework for cryptocurrency regulation and Central Bank Digital Currency (CBDC)',
      status: 'upcoming',
      county: 'National',
      category: 'Finance',
      deadline: '2025-10-20',
      participants: 892,
      isTracked: false,
      controversy: 'medium',
      impact: 'Will determine future of digital currencies in Kenya',
      tags: ['cryptocurrency', 'fintech', 'digital-currency', 'regulation']
    },
    { 
      id: 'bill-6',
      title: 'Coffee Cherry Revolving Fund Bill', 
      desc: 'Government intervention in coffee pricing and farmer payments',
      status: 'active',
      county: 'National',
      category: 'Agriculture',
      deadline: '2025-07-30',
      participants: 567,
      isTracked: false,
      controversy: 'medium',
      impact: 'Direct impact on coffee farmers and cooperative societies',
      tags: ['coffee-farmers', 'agricultural-pricing', 'cooperatives']
    },
    // COUNTY LEVEL - Strategic and Controversial Bills
    { 
      id: 'bill-7',
      title: 'Nairobi City Revenue Enhancement Bill 2025', 
      desc: 'New parking fees, property rates increase, and digital business permits',
      status: 'active',
      county: 'Nairobi',
      category: 'Finance',
      deadline: '2025-06-25',
      participants: 2156,
      isTracked: true,
      controversy: 'high',
      impact: 'All Nairobi businesses and property owners affected',
      tags: ['city-revenue', 'parking-fees', 'property-rates', 'business-permits']
    },
    { 
      id: 'bill-8',
      title: 'Kiambu County Alcoholic Drinks Control Amendment Bill', 
      desc: 'Stricter licensing, operating hours, and proximity to schools restrictions',
      status: 'active',
      county: 'Kiambu',
      category: 'Social',
      deadline: '2025-08-05',
      participants: 743,
      isTracked: false,
      controversy: 'high',
      impact: 'Affects bars, restaurants, and alcohol retailers in Kiambu',
      tags: ['alcohol-control', 'licensing', 'social-policy']
    },
    { 
      id: 'bill-9',
      title: 'Turkana County Mining Revenue Sharing Bill', 
      desc: 'Increased local community share of mining revenues and environmental protection',
      status: 'upcoming',
      county: 'Turkana',
      category: 'Mining',
      deadline: '2025-11-30',
      participants: 289,
      isTracked: true,
      controversy: 'high',
      impact: 'Major implications for oil and mineral extraction communities',
      tags: ['mining-revenue', 'community-benefit', 'environmental-protection']
    }
  ];

  // Enhanced consultations data
  const mockConsultations = [
    {
      id: 'cons-1',
      title: "Climate Change Adaptation Strategy 2025-2030",
      summary: "National framework for climate resilience including drought management, flood control, and agricultural adaptation measures.",
      county: "National",
      category: "Environment",
      deadline: "2025-07-15",
      participants: 1567,
      controversy: 'medium',
      impact: 'Will guide climate policy for next 5 years',
      tags: ['climate-change', 'adaptation', 'agriculture', 'disaster-management']
    },
    {
      id: 'cons-2',
      title: "Affordable Housing Implementation Guidelines",
      summary: "Public consultation on housing project locations, beneficiary criteria, and community participation in the government's housing agenda.",
      county: "National",
      category: "Housing",
      deadline: "2025-08-10",
      participants: 2134,
      controversy: 'high',
      impact: 'Determines how housing levy funds will be utilized',
      tags: ['affordable-housing', 'beneficiary-criteria', 'community-participation']
    },
    {
      id: 'cons-3',
      title: "Nairobi Metropolitan Area Transport Master Plan",
      summary: "Comprehensive transport strategy including BRT expansion, road networks, and non-motorized transport infrastructure.",
      county: "Nairobi",
      category: "Transport",
      deadline: "2025-09-05",
      participants: 1876,
      controversy: 'medium',
      impact: 'Will reshape urban mobility for millions of residents',
      tags: ['urban-transport', 'brt', 'infrastructure', 'mobility']
    }
  ];

  // Application state management
  const state = {
    currentTab: 'all',
    filters: {
      search: '',
      status: 'all',
      county: '',
      category: '',
      controversy: ''
    },
    bills: [...mockBills],
    consultations: [...mockConsultations],
    trackedBills: new Set(mockBills.filter(b => b.isTracked).map(b => b.id))
  };

  // DOM element cache with lazy loading
  const elements = {
    get searchInput() { return document.getElementById('searchInput'); },
    get filterSelect() { return document.getElementById('filterSelect'); },
    get countySelect() { return document.getElementById('countySelect'); },
    get categorySelect() { return document.getElementById('categorySelect'); },
    get controversySelect() { return document.getElementById('controversySelect'); },
    get profileBtn() { return document.getElementById('profileBtn'); },
    get onboardingBtn() { return document.getElementById('onboardingBtn'); },
    get loadingSpinner() { return document.getElementById('loadingSpinner'); },
    get errorMessage() { return document.getElementById('errorMessage'); }
  };

  // Utility functions
  const utils = {
    /**
     * Debounce function to limit rapid function calls
     * @param {Function} func - Function to debounce
     * @param {number} wait - Wait time in milliseconds
     * @returns {Function} Debounced function
     */
    debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    },

    /**
     * Check if deadline is approaching (within 14 days)
     * @param {string} deadline - Deadline in YYYY-MM-DD format
     * @returns {boolean} True if deadline is close
     */
    isDeadlineClose(deadline) {
      const deadlineDate = new Date(deadline);
      const now = new Date();
      const differenceInDays = Math.ceil((deadlineDate - now) / (1000 * 60 * 60 * 24));
      return differenceInDays <= 14 && differenceInDays >= 0;
    },

    /**
     * Format deadline for display
     * @param {string} deadline - Deadline in YYYY-MM-DD format
     * @returns {string} Formatted date string
     */
    formatDeadline(deadline) {
      const date = new Date(deadline);
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-KE', options);
    },

    /**
     * Get controversy badge color
     * @param {string} level - Controversy level (high, medium, low)
     * @returns {string} CSS class for controversy badge
     */
    getControversyClass(level) {
      const classes = {
        'high': 'controversy-high',
        'medium': 'controversy-medium',
        'low': 'controversy-low'
      };
      return classes[level] || 'controversy-low';
    },

    /**
     * Sanitize HTML to prevent XSS
     * @param {string} str - String to sanitize
     * @returns {string} Sanitized string
     */
    sanitizeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    },

    /**
     * Show loading state
     * @param {boolean} show - Whether to show loading
     */
    showLoading(show = true) {
      const spinner = elements.loadingSpinner;
      if (spinner) {
        spinner.style.display = show ? 'block' : 'none';
      }
    },

    /**
     * Show error message
     * @param {string} message - Error message to display
     */
    showError(message) {
      const errorEl = elements.errorMessage;
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.style.display = 'block';
        setTimeout(() => {
          errorEl.style.display = 'none';
        }, 5000);
      }
    }
  };

  // Enhanced rendering functions
  const renderer = {
    /**
     * Render bills with enhanced features
     * @param {string} containerId - Container element ID
     * @param {Array} bills - Bills array to render
     */
    renderBills(containerId, bills) {
      const container = document.getElementById(containerId);
      if (!container) return;

      if (bills.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No bills found</h3>
            <p>Try adjusting your filters or search terms.</p>
          </div>
        `;
        return;
      }

      const billsHTML = bills.map(bill => this.createBillHTML(bill)).join('');
      container.innerHTML = billsHTML;
      
      // Add event listeners after rendering
      this.attachBillEventListeners(container);
    },

    /**
     * Create HTML for a single bill
     * @param {Object} bill - Bill object
     * @returns {string} HTML string for the bill
     */
    createBillHTML(bill) {
      const isTracked = state.trackedBills.has(bill.id);
      const deadlineClass = utils.isDeadlineClose(bill.deadline) ? 'deadline-soon' : '';
      const controversyClass = utils.getControversyClass(bill.controversy);
      
      return `
        <article class="bill-item ${controversyClass}" id="${bill.id}" data-bill-id="${bill.id}">
          <div class="bill-header">
            <h3>${utils.sanitizeHTML(bill.title)}</h3>
            <div class="bill-meta">
              <span class="controversy-badge ${controversyClass}">
                ${bill.controversy} controversy
              </span>
              <span class="level-badge ${bill.county === 'National' ? 'national' : 'county'}">
                ${bill.county === 'National' ? 'National' : 'County'}
              </span>
            </div>
          </div>
          
          <p class="bill-description">${utils.sanitizeHTML(bill.desc)}</p>
          
          <div class="bill-impact">
            <strong>Impact:</strong> ${utils.sanitizeHTML(bill.impact)}
          </div>
          
          <div class="tags">
            <span class="tag location">${utils.sanitizeHTML(bill.county)}</span>
            <span class="tag category">${utils.sanitizeHTML(bill.category)}</span>
            <span class="tag status status-${bill.status}">${utils.sanitizeHTML(bill.status)}</span>
          </div>
          
          <div class="bill-stats">
            <div class="deadline">
              <span class="icon">📅</span>
              Deadline: <span class="${deadlineClass}">${utils.formatDeadline(bill.deadline)}</span>
            </div>
            <div class="participants">
              <span class="icon">👥</span>
              ${bill.participants.toLocaleString()} participants
            </div>
          </div>
          
          <div class="bill-actions">
            <button 
              class="track-btn ${isTracked ? 'tracked' : ''}" 
              data-bill-id="${bill.id}"
              aria-label="${isTracked ? 'Untrack' : 'Track'} ${bill.title}"
              aria-pressed="${isTracked}"
            >
              <span class="icon">${isTracked ? '★' : '☆'}</span>
              ${isTracked ? 'Untrack' : 'Track'}
            </button>
            <button class="comment-btn" aria-label="Comment on ${bill.title}">
              <span class="icon">💬</span>
              Comment
            </button>
            <button class="details-btn" aria-label="View details of ${bill.title}">
              <span class="icon">📄</span>
              Details
            </button>
            <button class="share-btn" aria-label="Share ${bill.title}">
              <span class="icon">🔗</span>
              Share
            </button>
          </div>
        </article>
      `;
    },

    /**
     * Render consultations
     * @param {string} containerId - Container element ID
     * @param {Array} consultations - Consultations array to render
     */
    renderConsultations(containerId, consultations) {
      const container = document.getElementById(containerId);
      if (!container) return;

      if (consultations.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No consultations found</h3>
            <p>Try adjusting your filters or search terms.</p>
          </div>
        `;
        return;
      }

      const consultationsHTML = consultations.map(consultation => 
        this.createConsultationHTML(consultation)
      ).join('');
      
      container.innerHTML = consultationsHTML;
      this.attachConsultationEventListeners(container);
    },

    /**
     * Create HTML for a single consultation
     * @param {Object} consultation - Consultation object
     * @returns {string} HTML string for the consultation
     */
    createConsultationHTML(consultation) {
      const controversyClass = utils.getControversyClass(consultation.controversy);
      
      return `
        <article class="consultation-item ${controversyClass}" id="${consultation.id}">
          <div class="consultation-header">
            <h3>${utils.sanitizeHTML(consultation.title)}</h3>
            <span class="controversy-badge ${controversyClass}">
              ${consultation.controversy} controversy
            </span>
          </div>
          
          <p class="consultation-summary">${utils.sanitizeHTML(consultation.summary)}</p>
          
          <div class="consultation-impact">
            <strong>Impact:</strong> ${utils.sanitizeHTML(consultation.impact)}
          </div>
          
          <div class="tags">
            <span class="tag location">${utils.sanitizeHTML(consultation.county)}</span>
            <span class="tag category">${utils.sanitizeHTML(consultation.category)}</span>
          </div>
          
          <div class="consultation-stats">
            <div class="deadline">
              <span class="icon">📅</span>
              Deadline: ${utils.formatDeadline(consultation.deadline)}
            </div>
            <div class="participants">
              <span class="icon">👥</span>
              ${consultation.participants.toLocaleString()} participants
            </div>
          </div>
          
          <div class="consultation-actions">
            <button class="participate-btn" aria-label="Participate in ${consultation.title}">
              <span class="icon">✋</span>
              Participate
            </button>
            <button class="comment-btn" aria-label="Comment on ${consultation.title}">
              <span class="icon">💬</span>
              Comment
            </button>
            <button class="details-btn" aria-label="View details of ${consultation.title}">
              <span class="icon">📄</span>
              Details
            </button>
          </div>
        </article>
      `;
    },

    /**
     * Attach event listeners to bill elements
     * @param {HTMLElement} container - Container element
     */
    attachBillEventListeners(container) {
      // Track button listeners
      container.querySelectorAll('.track-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const billId = e.target.closest('.track-btn').dataset.billId;
          eventHandlers.toggleTrackBill(billId);
        });
      });

      // Other action listeners
      container.querySelectorAll('.comment-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const billId = e.target.closest('.bill-item').dataset.billId;
          eventHandlers.openCommentModal(billId);
        });
      });

      container.querySelectorAll('.details-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const billId = e.target.closest('.bill-item').dataset.billId;
          eventHandlers.showBillDetails(billId);
        });
      });

      container.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const billId = e.target.closest('.bill-item').dataset.billId;
          eventHandlers.shareBill(billId);
        });
      });
    },

    /**
     * Attach event listeners to consultation elements
     * @param {HTMLElement} container - Container element
     */
    attachConsultationEventListeners(container) {
      container.querySelectorAll('.participate-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const consultationId = e.target.closest('.consultation-item').id;
          eventHandlers.participateInConsultation(consultationId);
        });
      });
    }
  };

  // Enhanced filtering system
  const filterSystem = {
    /**
     * Apply all active filters to bills and consultations
     */
    applyFilters() {
      utils.showLoading(true);
      
      // Use setTimeout to prevent UI blocking
      setTimeout(() => {
        try {
          const filteredBills = this.filterBills(state.bills);
          const filteredConsultations = this.filterConsultations(state.consultations);
          
          // Update displays based on current tab
          this.updateDisplays(filteredBills, filteredConsultations);
          utils.showLoading(false);
        } catch (error) {
          console.error('Filter error:', error);
          utils.showError('Error applying filters. Please try again.');
          utils.showLoading(false);
        }
      }, 100);
    },

    /**
     * Filter bills based on current state
     * @param {Array} bills - Bills to filter
     * @returns {Array} Filtered bills
     */
    filterBills(bills) {
      return bills.filter(bill => {
        const matchesSearch = this.matchesSearchTerm(bill, state.filters.search);
        const matchesStatus = this.matchesStatus(bill, state.filters.status);
        const matchesCounty = this.matchesCounty(bill, state.filters.county);
        const matchesCategory = this.matchesCategory(bill, state.filters.category);
        const matchesControversy = this.matchesControversy(bill, state.filters.controversy);
        
        return matchesSearch && matchesStatus && matchesCounty && 
               matchesCategory && matchesControversy;
      });
    },

    /**
     * Filter consultations based on current state
     * @param {Array} consultations - Consultations to filter
     * @returns {Array} Filtered consultations
     */
    filterConsultations(consultations) {
      return consultations.filter(consultation => {
        const matchesSearch = this.matchesSearchTerm(consultation, state.filters.search);
        const matchesCounty = this.matchesCounty(consultation, state.filters.county);
        const matchesCategory = this.matchesCategory(consultation, state.filters.category);
        const matchesControversy = this.matchesControversy(consultation, state.filters.controversy);
        
        return matchesSearch && matchesCounty && matchesCategory && matchesControversy;
      });
    },

    /**
     * Check if item matches search term
     * @param {Object} item - Item to check
     * @param {string} searchTerm - Search term
     * @returns {boolean} True if matches
     */
    matchesSearchTerm(item, searchTerm) {
      if (!searchTerm) return true;
      
      const term = searchTerm.toLowerCase();
      const searchableFields = [
        item.title,
        item.desc || item.summary,
        item.impact,
        ...(item.tags || [])
      ];
      
      return searchableFields.some(field => 
        field && field.toLowerCase().includes(term)
      );
    },

    /**
     * Check if bill matches status filter
     * @param {Object} bill - Bill to check
     * @param {string} status - Status filter
     * @returns {boolean} True if matches
     */
    matchesStatus(bill, status) {
      return !status || status === 'all' || bill.status === status;
    },

    /**
     * Check if item matches county filter
     * @param {Object} item - Item to check
     * @param {string} county - County filter
     * @returns {boolean} True if matches
     */
    matchesCounty(item, county) {
      return !county || item.county === county;
    },

    /**
     * Check if item matches category filter
     * @param {Object} item - Item to check
     * @param {string} category - Category filter
     * @returns {boolean} True if matches
     */
    matchesCategory(item, category) {
      return !category || item.category === category;
    },

    /**
     * Check if item matches controversy filter
     * @param {Object} item - Item to check
     * @param {string} controversy - Controversy filter
     * @returns {boolean} True if matches
     */
    matchesControversy(item, controversy) {
      return !controversy || item.controversy === controversy;
    },

    /**
     * Update displays with filtered data
     * @param {Array} filteredBills - Filtered bills
     * @param {Array} filteredConsultations - Filtered consultations
     */
    updateDisplays(filteredBills, filteredConsultations) {
      // All bills
      renderer.renderBills('tab-all', filteredBills);
      
      // Tracked bills
      const trackedBills = filteredBills.filter(bill => 
        state.trackedBills.has(bill.id)
      );
      renderer.renderBills('tab-tracked', trackedBills);
      
      // Recommended bills (high impact, not tracked)
      const recommendedBills = filteredBills
        .filter(bill => !state.trackedBills.has(bill.id) && bill.participants > 1000)
        .sort((a, b) => b.participants - a.participants)
        .slice(0, 5);
      renderer.renderBills('tab-recommended', recommendedBills);
      
      // Consultations
      renderer.renderConsultations('tab-consultations', filteredConsultations);
    }
  };

  // Event handlers
  const eventHandlers = {
    /**
     * Toggle bill tracking status
     * @param {string} billId - Bill ID to toggle
     */
    toggleTrackBill(billId) {
      try {
        if (state.trackedBills.has(billId)) {
          state.trackedBills.delete(billId);
        } else {
          state.trackedBills.add(billId);
        }
        
        // Update bill object for consistency
        const bill = state.bills.find(b => b.id === billId);
        if (bill) {
          bill.isTracked = state.trackedBills.has(billId);
        }
        
        // Reapply filters to update displays
        filterSystem.applyFilters();
        
        // Optional: Save to localStorage if available
        this.saveUserPreferences();
      } catch (error) {
        console.error('Error toggling bill tracking:', error);
        utils.showError('Failed to update tracking status.');
      }
    },

    /**
     * Handle tab switching
     * @param {string} tabName - Name of tab to switch to
     */
    switchTab(tabName) {
      try {
        // Update state
        state.currentTab = tabName;
        
        // Update tab button states
        document.querySelectorAll('.tab-list button').forEach(btn => {
          const isActive = btn.getAttribute('data-tab') === tabName;
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-selected', isActive.toString());
        });
        
        // Show/hide tab content
        ['all', 'tracked', 'recommended', 'consultations'].forEach(t => {
          const tabElement = document.getElementById('tab-' + t);
          if (tabElement) {
            tabElement.style.display = (t === tabName) ? '' : 'none';
          }
        });
        
        // Announce tab change for screen readers
        this.announceTabChange(tabName);
      } catch (error) {
        console.error('Error switching tabs:', error);
        utils.showError('Error switching tabs.');
      }
    },

    /**
     * Handle filter changes
     * @param {string} filterType - Type of filter
     * @param {string} value - Filter value
     */
    updateFilter(filterType, value) {
      state.filters[filterType] = value;
      filterSystem.applyFilters();
    },

    /**
     * Open comment modal for a bill
     * @param {string} billId - Bill ID
     */
    openCommentModal(billId) {
      const bill = state.bills.find(b => b.id === billId);
      if (bill) {
        console.log('Opening comment modal for:', bill.title);
        // Implementation would open a modal here
        alert(`Comment modal for: ${bill.title}\n\nThis would open a proper modal in the full implementation.`);
      }
    },

    /**
     * Show bill details
     * @param {string} billId - Bill ID
     */
    showBillDetails(billId) {
      const bill = state.bills.find(b => b.id === billId);
      if (bill) {
        console.log('Showing details for:', bill.title);
        // Implementation would show detailed view
        window.location.href = `bill-details.html?id=${billId}`;
      }
    },

    /**
     * Share bill
     * @param {string} billId - Bill ID
     */
    shareBill(billId) {
      const bill = state.bills.find(b => b.id === billId);
      if (bill && navigator.share) {
        navigator.share({
          title: bill.title,
          text: bill.desc,
          url: `${window.location.origin}/bill-details.html?id=${billId}`
        }).catch(err => console.log('Error sharing:', err));
      } else if (bill) {
        // Fallback: copy to clipboard
        const shareText = `${bill.title}\n${bill.desc}\n${window.location.origin}/bill-details.html?id=${billId}`;
        navigator.clipboard.writeText(shareText).then(() => {
          utils.showError('Link copied to clipboard!');
        }).catch(() => {
          alert(shareText);
        });
      }
    },

    /**
     * Participate in consultation
     * @param {string} consultationId - Consultation ID
     */
    participateInConsultation(consultationId) {
      const consultation = state.consultations.find(c => c.id === consultationId);
      if (consultation) {
        console.log('Participating in:', consultation.title);
        window.location.href = `consultation-participate.html?id=${consultationId}`;
      }
    },

    /**
     * Save user preferences
     */
    saveUserPreferences() {
      try {
        // Note: In a real implementation, this would save to a backend
        // For demo purposes, we'll use sessionStorage if available
        if (typeof Storage !== 'undefined') {
          const preferences = {
            trackedBills: Array.from(state.trackedBills),
            filters: state.filters,
            currentTab: state.currentTab
          };
          sessionStorage.setItem('civicEngagementPrefs', JSON.stringify(preferences));
        }
      } catch (error) {
        console.error('Error saving preferences:', error);
      }
    },

    /**
     * Load user preferences
     */
    loadUserPreferences() {
      try {
        if (typeof Storage !== 'undefined') {
          const saved = sessionStorage.getItem('civicEngagementPrefs');
          if (saved) {
            const preferences = JSON.parse(saved);
            
            // Restore tracked bills
            if (preferences.trackedBills) {
              state.trackedBills = new Set(preferences.trackedBills);
              // Update bill objects
              state.bills.forEach(bill => {
                bill.isTracked = state.trackedBills.has(bill.id);
              });
            }
            
            // Restore filters
            if (preferences.filters) {
              Object.assign(state.filters, preferences.filters);
            }
            
            // Restore current tab
            if (preferences.currentTab) {
              state.currentTab = preferences.currentTab;
            }
          }
        }
      } catch (error) {
        console.error('Error loading preferences:', error);
      }
    },

    /**
     * Announce tab change for accessibility
     * @param {string} tabName - Name of the active tab
     */
    announceTabChange(tabName) {
      const announcements = {
        'all': 'All bills tab selected',
        'tracked': 'Tracked bills tab selected',
        'recommended': 'Recommended bills tab selected',
        'consultations': 'Public consultations tab selected'
      };
      
      // Create or update live region for announcements
      let liveRegion = document.getElementById('live-announcements');
      if (!liveRegion) {
        liveRegion = document.createElement('div');
        liveRegion.id = 'live-announcements';
        liveRegion.setAttribute('aria-live', 'polite');
        liveRegion.setAttribute('aria-atomic', 'true');
        liveRegion.style.position = 'absolute';
        liveRegion.style.left = '-10000px';
        liveRegion.style.width = '1px';
        liveRegion.style.height = '1px';
        liveRegion.style.overflow = 'hidden';
        document.body.appendChild(liveRegion);
      }
      
      liveRegion.textContent = announcements[tabName] || `${tabName} tab selected`;
    },

    /**
     * Handle keyboard navigation for tabs
     * @param {KeyboardEvent} e - Keyboard event
     */
    handleTabKeyboard(e) {
      const tabs = Array.from(document.querySelectorAll('.tab-list button'));
      const currentIndex = tabs.indexOf(e.target);
      
      let newIndex = currentIndex;
      
      switch (e.key) {
        case 'ArrowRight':
          e.preventDefault();
          newIndex = (currentIndex + 1) % tabs.length;
          break;
        case 'ArrowLeft':
          e.preventDefault();
          newIndex = (currentIndex - 1 + tabs.length) % tabs.length;
          break;
        case 'Home':
          e.preventDefault();
          newIndex = 0;
          break;
        case 'End':
          e.preventDefault();
          newIndex = tabs.length - 1;
          break;
        case 'Enter':
        case ' ':
          e.preventDefault();
          this.switchTab(e.target.getAttribute('data-tab'));
          return;
      }
      
      if (newIndex !== currentIndex) {
        tabs[newIndex].focus();
      }
    }
  };

  // Analytics and insights
  const analytics = {
    /**
     * Get popular bills based on participation
     * @param {number} limit - Number of bills to return
     * @returns {Array} Popular bills
     */
    getPopularBills(limit = 5) {
      return [...state.bills]
        .sort((a, b) => b.participants - a.participants)
        .slice(0, limit);
    },

    /**
     * Get bills by controversy level
     * @param {string} level - Controversy level
     * @returns {Array} Bills matching controversy level
     */
    getBillsByControversy(level) {
      return state.bills.filter(bill => bill.controversy === level);
    },

    /**
     * Get upcoming deadlines
     * @param {number} days - Number of days to look ahead
     * @returns {Array} Bills with upcoming deadlines
     */
    getUpcomingDeadlines(days = 30) {
      const now = new Date();
      const futureDate = new Date(now.getTime() + (days * 24 * 60 * 60 * 1000));
      
      return state.bills.filter(bill => {
        const deadline = new Date(bill.deadline);
        return deadline >= now && deadline <= futureDate;
      }).sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
    },

    /**
     * Get engagement statistics
     * @returns {Object} Engagement stats
     */
    getEngagementStats() {
      const totalBills = state.bills.length;
      const trackedCount = state.trackedBills.size;
      const highControversyCount = this.getBillsByControversy('high').length;
      const upcomingDeadlines = this.getUpcomingDeadlines(14).length;
      
      return {
        totalBills,
        trackedCount,
        highControversyCount,
        upcomingDeadlines,
        engagementRate: totalBills > 0 ? (trackedCount / totalBills * 100).toFixed(1) : 0
      };
    }
  };

  // Initialization and setup
  const app = {
    /**
     * Initialize the application
     */
    async init() {
      try {
        console.log('Initializing Civic Engagement Platform...');
        
        // Load user preferences first
        eventHandlers.loadUserPreferences();
        
        // Setup DOM elements and event listeners
        this.setupEventListeners();
        
        // Setup accessibility features
        this.setupAccessibility();
        
        // Populate filter dropdowns
        this.populateFilterDropdowns();
        
        // Apply initial filters and render content
        await this.loadInitialContent();
        
        // Setup periodic updates
        this.setupPeriodicUpdates();
        
        console.log('Platform initialized successfully');
      } catch (error) {
        console.error('Initialization error:', error);
        utils.showError('Failed to initialize platform. Please refresh the page.');
      }
    },

    /**
     * Setup event listeners for all interactive elements
     */
    setupEventListeners() {
      // Navigation buttons
      elements.profileBtn?.addEventListener('click', () => {
        window.location.href = 'profile.html';
      });

      elements.onboardingBtn?.addEventListener('click', () => {
        window.location.href = 'onboarding.html';
      });

      // Tab switching
      document.querySelectorAll('.tab-list button').forEach(btn => {
        btn.addEventListener('click', () => {
          eventHandlers.switchTab(btn.getAttribute('data-tab'));
        });
        
        btn.addEventListener('keydown', (e) => {
          eventHandlers.handleTabKeyboard(e);
        });
      });

      // Filter controls with debounced handlers
      const debouncedFilter = utils.debounce(() => filterSystem.applyFilters(), 300);
      
      elements.searchInput?.addEventListener('input', (e) => {
        eventHandlers.updateFilter('search', e.target.value);
      });

      elements.filterSelect?.addEventListener('change', (e) => {
        eventHandlers.updateFilter('status', e.target.value);
      });

      elements.countySelect?.addEventListener('change', (e) => {
        eventHandlers.updateFilter('county', e.target.value);
      });

      elements.categorySelect?.addEventListener('change', (e) => {
        eventHandlers.updateFilter('category', e.target.value);
      });

      elements.controversySelect?.addEventListener('change', (e) => {
        eventHandlers.updateFilter('controversy', e.target.value);
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
          switch (e.key) {
            case 'f':
              e.preventDefault();
              elements.searchInput?.focus();
              break;
            case '1':
              e.preventDefault();
              eventHandlers.switchTab('all');
              break;
            case '2':
              e.preventDefault();
              eventHandlers.switchTab('tracked');
              break;
            case '3':
              e.preventDefault();
              eventHandlers.switchTab('recommended');
              break;
            case '4':
              e.preventDefault();
              eventHandlers.switchTab('consultations');
              break;
          }
        }
      });
    },

    /**
     * Setup accessibility features
     */
    setupAccessibility() {
      // Add skip links if not present
      if (!document.getElementById('skip-to-content')) {
        const skipLink = document.createElement('a');
        skipLink.id = 'skip-to-content';
        skipLink.href = '#main-content';
        skipLink.textContent = 'Skip to main content';
        skipLink.className = 'skip-link';
        document.body.insertBefore(skipLink, document.body.firstChild);
      }

      // Ensure proper ARIA labels and roles
      document.querySelectorAll('.tab-list').forEach(tabList => {
        tabList.setAttribute('role', 'tablist');
      });

      document.querySelectorAll('.tab-list button').forEach(tab => {
        tab.setAttribute('role', 'tab');
      });

      // Add proper headings hierarchy
      document.querySelectorAll('.bill-item h3, .consultation-item h3').forEach(heading => {
        heading.setAttribute('tabindex', '0');
      });
    },

    /**
     * Populate filter dropdown options
     */
    populateFilterDropdowns() {
      // Populate county dropdown
      const counties = [...new Set(state.bills.map(bill => bill.county))].sort();
      if (elements.countySelect) {
        elements.countySelect.innerHTML = '<option value="">All Counties</option>' +
          counties.map(county => `<option value="${county}">${county}</option>`).join('');
      }

      // Populate category dropdown
      const categories = [...new Set([...state.bills, ...state.consultations].map(item => item.category))].sort();
      if (elements.categorySelect) {
        elements.categorySelect.innerHTML = '<option value="">All Categories</option>' +
          categories.map(category => `<option value="${category}">${category}</option>`).join('');
      }

      // Populate controversy dropdown
      if (elements.controversySelect) {
        elements.controversySelect.innerHTML = `
          <option value="">All Levels</option>
          <option value="high">High Controversy</option>
          <option value="medium">Medium Controversy</option>
          <option value="low">Low Controversy</option>
        `;
      }
    },

    /**
     * Load initial content with simulated loading delay
     */
    async loadInitialContent() {
      utils.showLoading(true);
      
      // Simulate API loading delay
      await new Promise(resolve => setTimeout(resolve, 800));
      
      // Apply filters to render initial content
      filterSystem.applyFilters();
      
      // Set initial tab
      eventHandlers.switchTab(state.currentTab);
      
      utils.showLoading(false);
    },

    /**
     * Setup periodic updates for dynamic content
     */
    setupPeriodicUpdates() {
      // Update participation counts every 5 minutes
      setInterval(() => {
        state.bills.forEach(bill => {
          // Simulate participation growth
          if (Math.random() < 0.3) {
            bill.participants += Math.floor(Math.random() * 10) + 1;
          }
        });
        
        state.consultations.forEach(consultation => {
          if (Math.random() < 0.2) {
            consultation.participants += Math.floor(Math.random() * 5) + 1;
          }
        });
        
        // Reapply filters to update displays
        filterSystem.applyFilters();
      }, 300000); // 5 minutes
    },

    /**
     * Handle errors gracefully
     * @param {Error} error - Error object
     * @param {string} context - Context where error occurred
     */
    handleError(error, context = 'Unknown') {
      console.error(`Error in ${context}:`, error);
      utils.showError(`An error occurred in ${context}. Please try again.`);
    }
  };

  // Export utilities for external use (if needed)
  window.CivicEngagement = {
    analytics,
    utils,
    state: {
      getBills: () => state.bills,
      getConsultations: () => state.consultations,
      getTrackedBills: () => Array.from(state.trackedBills)
    }
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => app.init());
  } else {
    app.init();
  }

})();
  </script>

</body>
</html>